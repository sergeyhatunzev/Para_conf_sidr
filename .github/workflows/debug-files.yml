name: Debug - Показать все файлы в репозитории

on:
  workflow_dispatch:   # Запускается только вручную

jobs:
  debug-files:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0   # Полный клон, чтобы точно видеть все файлы
          clean: true      # Чистая рабочая директория

      - name: Показать ВСЕ файлы в репозитории
        run: |
          echo "=== Текущая директория ==="
          pwd
          echo ""
          
          echo "=== Все файлы и папки в корне (ls -la) ==="
          ls -la
          echo ""
          
          echo "=== Все файлы в репозитории (git ls-files) ==="
          git ls-files | sort
          echo ""
          
          echo "=== Поиск всех файлов вида vless*.txt (независимо от регистра) ==="
          find . -maxdepth 1 -type f -iname 'vless*.txt' -ls || echo "Не найдено ни одного vless*.txt"
          echo ""
          
          echo "=== Если файлы найдены — показываем их содержимое (первые 10 строк) ==="
          for file in $(find . -maxdepth 1 -type f -iname 'vless*.txt' 2>/dev/null); do
            echo "Файл: $file"
            echo "──────────────────────────────────────────"
            head -n 10 "$file" || echo "Не удалось прочитать файл"
            echo "──────────────────────────────────────────"
            echo ""
          done
          
          if ! find . -maxdepth 1 -type f -iname 'vless*.txt' | grep -q .; then
            echo "ВНИМАНИЕ: ФАЙЛОВ vless*.txt В КОРНЕ НЕ НАЙДЕНО!"
            echo "Возможные причины:"
            echo "1. Файл не закоммичен в репозиторий"
            echo "2. Файл в .gitignore"
            echo "3. Файл в другой ветке"
            echo "4. Имя файла отличается (регистр, пробелы, расширение)"
          fi
          
          echo "=== Конец отладки ==="
